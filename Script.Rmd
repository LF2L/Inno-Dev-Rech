---
title: "Script"
output: html_document
subtitle: "This is a subtitle"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#libraries
#devtools::install_github( "ThinkR-open/prenoms")
library("prenoms")

```

# Purpose of the Workshop:

One of the main principles of scientific research is related to its reproducible quality.

>Reproducibility refers to the ability of a researcher to duplicate the results of a prior study using the same materials that were used by the original researcher (Goodman, Fanelli, and Ioannidis 2016). This is a cornerstone of scientific research because if we cannot reproduce previous studies, we cannot rely on their results, and we cannot build on them to generate new knowledge.



# Representing the data
Important data types in R

1. Clasess:
  - Numerical, Character, Integer or Logical
2. Objects
  - Vectors, Matrices, Data frames, Lists, Factors, Missing values
3. Operations
  - Subsetting, Logical subsetting
  
Source:   

## Classes
#### Numerical
```{r Var_numerique}
# Définition d'une Variable Numérique
a_num <- 1
a_num
b_num <- 2
b_num
# Clase
class(a_num)


# Opérations basiques
somme_1 <- a_num + b_num  # somme
somme_2 <- sum(a_num, b_num)# somme

```

Lé résultat de la somme est **`r somme_1`**

#### Character
```{r, Var_char}
# Définition d'une variable type 'character' (texte)
a_char <- "Bonjour"
b_char <- "Comment ça va?" 

class(a_char) # Classe

# Opérations basiques
c_char <- paste(a_char, b_char, sep = ", ")
```

Lé résultat de 'Paste' est:  **`r c_char`**

#### Integer
```{r Var_int}
# Définition d'une variable type 'Integer' (Valeur Entier)
a_int <- 10L
b_int <- 2L

class(b_int) # Classe

# Opérations basiques
c_int <- sum(a_int, b_int)
class(c_int)
```

#### Logical

```{r}
# Définition d'une variable type 'Logical' (Valeur Entier)
a_log <- TRUE
b_log <- FALSE

class(a_log)

# Opérations basiques
C_int <- sum(a_log, a_log)

```



## Objects
### Vectors

A set of values with the **same class**

- The fonction `c()` is a '*combination fonction*'

```{r}
# Creation of a vector with the function c()
etudiants <- c("Maelle", "Luca", "Sandrine", "Marcelo", "Jean")
taille  <-  c(188, 173, 187, 164, 178)
age <- c(32, 23, 35, 35, 54)

class(age)

# Quelle est la moyenne de la taille des étudiants
mean(taille)


## What happen if we do:
test <- c("Maelle", "Luca", 118, 173, 1L)
#mean(test)
#class(test)

```


### Matrices

```{r}
# Creation d'une matrix
a_Matrix <-  matrix(c(1, 2, 3, 4), byrow = T, nrow = 2)
a_Matrix
vector <- c(1,3)

# Opérations basiques
a_Matrix*2
a_Matrix*vector

```

### List
A vector of values of possibly different classes

```{r}
# Creation d'une List
v1 <- c("Maelle", "Luca", "Sandrine", "Marcelo", "Jean")
v2  <-  c(188, 173, 187, 164, 178)
v3 <- c(32, 23, 35, 35, 54)

a_list <- list(etudiant = v1,
               taille = v2,
               age = v3 )
a_list

class(a_list)

```

### Data frames

MOst common type of data --> Tableau Excel! 

```{r}
# Creation d'une data frame
v1 <- c("Maelle", "Luca", "Sandrine", "Marcelo", "Jean")
v2  <-  c(188, 173, 187, 164, 178)
v3 <- c(32, 23, 35, 35, 54)

a_dataframe <-  data.frame(etudiant = v1, 
                           taille = v2, 
                           v3 = age)

```

### Factors

Qualitative variables that can be included in models

```{r}
# Definition des facteur de base d'une vector

fumeur = c("yes", "no", "yes", "yes", "no")
fumeur = as.factor(fumeur)
fumeur

# On peut ajouter cet infor au dataframe initial
a_dataframe$fumeur <- fumeur
```



### Missing Values

In R they are usually coded `NA`

```{r}
# Imaginez que vous n'avez pas tout les donnes:

sportif = c("yes", "no", "yes", "yes")
#a_dataframe$sportif <- sportif

# Attention au dimmensions des vecteur --> Si on ajoute des vecteur des different dimensions

# Use of NA
sportif = c("yes", "no", "yes", "yes", NA)
#a_dataframe$sportif <- sportif

```

## Subsetting elements

```{r}
# Selecting some elements inside the vector
etudiants <- c("Maelle", "Luca", "Sandrine", "Marcelo", "Jean")

# Une ou plusiers elements dans un vecteur
etudiants[1]
etudiants[c(1,2)]
etudiants[c(1,2,3)]
etudiants[1:3]
```


```{r}
# Une ou plusiers elements dans un Data Frame
data <- 
  data.frame(
    etudiants = c("Maelle", "Luca", "Sandrine", "Marcelo", "Jean"),
    taille  =  c(188, 173, 187, 164, 178),
    age = c(32, 23, 35, 38, 54),
    sportif = c("yes", "no", "yes", "yes", NA)
  )

# Filtre une ligne
data[1 , ] 
data[c(1,2) , ]
data[1:3 , ]


# Filtrer une colonne
data[ , 1]
data[ , c(1,2)]
data[ , 2:3]

# Filtrer une ligne et une colonne

data[1:2, 2:3]


# Logical Subsetting
data[age > 30,   ]

data[data$etudiants == "Maelle", ]


```


### Exercise on Basics

```{r Ex:1}

```

---

**Take a rest of 5 Min**

---


# Tidyverse



## Import Data

`readr` et `readxl` permettent d’importer des données tabulaires depuis des fichiers texte ou Excel.
Une interface intégrée à RStudio facilite leur usage en permettant de modifier les options d’importation et d’avoir un aperçu en temps réel.

```{r}
# Load the library
library(tidyverse)
```


```{r}
# Lire un base de donnes CSV:
data.csv <- read_csv("data/data-twitter-article.csv")
data.csv


# Lire un base de donnes Excel
library(readxl)
data.excel <- read_excel("data/clippy.xls" )

# Lire un onglet d'excel ---> Il faut savoir quel's sont les onglets du document
onglets <- excel_sheets("data/deaths.xlsx")
data.excel.onglets <- read_excel("data/deaths.xlsx", sheet = onglets[1] )
data.excel.onglets <- read_excel("data/deaths.xlsx", sheet = onglets[1], skip = 4 )
data.excel.onglets <- read_excel("data/deaths.xlsx", sheet = onglets[1], skip = 4 )

```

## Export de tableaux de données

On peut avoir besoin d’exporter un tableau de données dans R vers un fichier dans différents formats. La plupart des fonctions d’import disposent d’un équivalent permettant l’export de données. On citera notamment :

- `write_csv`, `write_csv2`, `read_tsv` permettent d’enregistrer un data frame ou un tibble dans un fichier au format texte délimité

```{r}
# Exporté des donnes

# With csv et csv2
write_csv(data.csv, file= "data/export-csv.csv")
write_csv2(data.csv, file= "data/export-csv2.csv")

```


## Tidy
Les principes d’un jeu de données tidy sont les suivants :

- chaque variable est une colonne
- chaque observation est une ligne
- chaque type d’observation est dans une table différente



```{r message=FALSE, warning=FALSE, include=FALSE}

# Chunk not included for Students

library(knitr, quietly = TRUE)
library(tidyverse, quietly = TRUE)
library(gapminder, quietly = TRUE)

data <- 
  data.frame(
    etudiants = c("Maelle", "Luca", "Sandrine", "Marcelo", "Jean"),
    taille  =  c(188, 173, 187, 164, 178),
    age = c(32, 23, 35, 38, 54),
    sportif = c("yes", "no", "yes", "yes", NA)
  )

data %>% 
  dplyr::select(etudiants, taille, sportif) %>%
  spread(taille, sportif)

data(gapminder)
d <- gapminder
dm <- d %>% 
  filter(
    country %in% c("France", "Germany", "Belgium"),
    year >= 1992
  ) %>%
  dplyr::select(country, year, pop) %>% 
  spread(year, pop)
kable(dm)

# write_csv(dm, file = "data/non-tidy.csv")
```

Prenons un exemple avec les données suivantes, qui indique la population de trois pays pour quatre années différentes :

```{r }
# Data in 'NON tidy' form

 data.non.tidy <- read_csv(dm, file = "data/non-tidy.csv")
```




## Pipe Operation



## Main Verbs 

### filter()
### summarise()
### group_by()
### mutate()
### arrange()


```{r}

```

1. You know the Five Main Verbs (5MV) of data wrangling
2. You will know the Pipe operator ('Ceci n'est pas une pipe')
3. Tidy data approach



# Final Exercise

## Gapminder challenge


- Inspired by the late, great [Hans Rosling](https://www.youtube.com/watch?v=jbkSRLYSojo)


Install and load the [`gapminder` data package](https://github.com/jennybc/gapminder)

```{r, eval=FALSE, echo=TRUE, include=TRUE}
install.packages("gapminder")
library(gapminder)
gapminder
```


Pick at least __two__ of the tasks below from the task menu and approach each with a table and figure. 

  * `dplyr` should be your main data manipulation tool
  * `ggplot2` should be your main visualization tool

## Tasks menu {-}

* The mean life expectancy across all years for France?

* Get the maximum and minimum of GDP per capita for all continents.

* Look at the spread of GDP per capita across countries within the continents.

* How does life expectancy vary across different continents? (Using a `ggplot`)




* Report the absolute and/or relative abundance of countries with low life expectancy over time by continent: Compute some measure of worldwide life expectancy - you decide - a mean or median or some other quantile or perhaps your current age. Then determine how many countries on each continent have a life expectancy less than this benchmark, for each year.

* Make up your own! 


---


You're encouraged to reflect on what was hard/easy, problems you solved, helpful tutorials you read, etc.








 
